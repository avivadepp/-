### 三级模式，两级映射
内模式：数据的存放，物理级数据库  
概念模式：数据库表，概念级数据库  
外模式：数据库视图（视图是从一个或几个基本表（或视图）中导出的虚拟的表。），用户级数据库  
### 数据库设计过程
- 需求分析
- 概念结构设计:ER模型
- 逻辑结构设计:关系模式
- 物理设计
### ER模型转关系模式
一个实体转成一个关系模式,
联系有三种不同类型:
- 1:1联系：联系可以放在任何一个实体里
- 1:n联系：联系放在n端
- m:n联系:联系必须转成一个单独的实体
### 关系代数
- 并
- 交
- 差
- 笛卡尔积：从集合A选一个，再从集合B选一个，所有可能的组合
- 投影：π,选出需要的列
- 选择：σ,选出需要的行
- 联接：两个相对的三角形,根据条件连接在一起，没有写条件就是自然连接，连接方式是两个表中相同的字段等值
### 规范化理论
1，函数依赖:某个属性集决定另一个属性集时，称另一属性集依赖于该属性集。  
- 部分函数依赖：(A,B)->C且A->C
- 传递函数依赖: A->B且B->C,B不确定A，则A->C  

2，价值与用途：数据冗余、更新异常、插入异常、删除异常  
3，键：
- 超键：唯一标识元组
- 候选键：超键消除多余属性后变为候选键  
- 主键：候选键任选一个
- 外键：其他关系的主键

4，求解候选键：图示法  
将关系模式的函数依赖用有向图表示；找入度为0的属性，若以此为起点能遍历有向图，则该属性为候选键；若不能，则尝试将一些属性加入，再次遍历  
5,范式：
- 1NF：属性都是不可分的原子值
- 2NF：1NF消除非主属性对候选键的部份依赖
- 3NF：2NF消除非主属性对候选键的传递依赖
- BCNF: 3NF消除主属性对候选键的传递依赖，R属于BCNF当且仅当其F中每个依赖的决定因素必定包含R的某个候选码

5，模式分解
要求：  
保持函数依赖分解  
无损分解 无损联接分解：指将一个关系模式分解成若干个关系模式后，通过自然连接和投影等运算仍能还原到原来的关系模式  

#### 数据库并发控制
1，事务：原子性（事务中的操作要么全做，要么全不做），一致性（类似于能量守恒)，隔离性，持续性（事务执行后，结果影响是持续的）  
2，并发产生的问题：丢失更新，脏读(读到了执行过程中的临时值)，不可重复读（验算不对）  
3，封锁协议：（S封锁，X封锁）/（一级二级三级封锁协议，两段封锁协议）
- X锁和S锁：shared lock和exclusive lock（共享锁和排他锁，也叫读锁和写锁，即read lock和write lock）
  - 若事务T对数据对象A加上S锁，则事务T可以读A但不能修改A，其他事务只能再对A加S锁，而不能加X锁，直到T释放A上的S锁。
  - 若事务T对数据对象A加上X锁，事务T可以读A也可以修改A，其他事务不能再对A加任何锁，直到T释放A上的锁。
- 一级封锁协议：事务T在修改 **（由于事务的原子性，实际上是读取前）** 数据R之前必须加X锁，直到事务结束才释放。可防止丢失修改。
- 二级封锁协议：一级封锁协议基础上，读数据之前先加S锁，读完可释放，可防止丢失修改和脏读。（T1加了X锁，T2申请S锁被拒绝)
- 三级封锁协议：一级封锁协议基础上，读数据之前先加S锁，事务结束才释放，可防止丢失修改和脏读、不可重复读。
- 两段锁协议：可串行化，可能发生死锁。
4，死锁

#### 数据库完整性约束
- 实体完整性：主键值不能为空，不能重复；
- 参照完整性：外键必须是对应表中主键的内容，但允许为空；
- 用户自定义完整性：用户自己设置属性值的情况
- 触发器：复杂情况写脚本来约束数据库

#### 数据库安全
用户识别和鉴定：最外层，使用账号口令等
存取控制：对用户进行授权
密码存储和传输：对远程终端信息用密码传输
视图的保护：对视图进行授权
审计：用一个专用文件或数据库，自动将用户对数据库的所有操作记录下来

#### 数据备份
- 备份方式
  - 冷备份（静态备份）：将数据库正常关闭并复制数据
  - 热备份（动态备份）：利用备份软件，在数据库正常运行的情况下复制。
- 备份的量
  - 完全备份：备份所有
  - 差量： 备份上一次**完全备份**之后变化的数据
  - 增量：备份上一次备份后变化的数据
- 日志文件
- 故障与回复
  - 可预期故障：本身逻辑，rollback语句
  - 不可预期：算术溢出等，日志
  - 系统故障：系统停止故障,检查点
  - 介质故障：外存被破坏，使用日志重做业务

  #### 数据仓库与数据挖掘
  数据仓库：面向主题，集成的，相对稳定的，反映历史变化

  #### 反规范化技术
  增加派生性冗余列、增加冗余列、重新组表、分割表

  #### 大数据
  5V：Volume数据量大；Variety种类和来源多样化；Value数据价值密度相对较低；Velocity数据增长速度快，处理速度也快，时效性要求高；Veracity数据的准确性和可信赖度，即数据的质量。
